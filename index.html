<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow Work Journaling</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 800px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #444;
        }

        .prompt {
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #555;
        }

        .writing-area {
            width: 100%;
            height: 200px;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            font-size: 16px;
            background: #f9f9f9;
            resize: none;
        }

        #flashing-light {
            width: 20px;
            height: 20px;
            background-color: red;
            border-radius: 50%;
            margin: 10px auto;
            display: none;
            animation: flash 1s infinite;
        }

        @keyframes flash {
            0%, 100% {
                opacity: 0.5;
            }
            50% {
                opacity: 1;
            }
        }

        .timer {
            text-align: center;
            font-size: 16px;
            margin-top: 10px;
        }

        button {
            display: block;
            margin: 20px auto 0;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #5cb85c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #4cae4c;
        }

        .warning {
            color: red;
            font-weight: bold;
        }

        .word-count {
            text-align: right;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
    </style>
    
</head>
<body>
    <div class="container">
        <h1>Shadow Work Journaling</h1>
        <div class="prompt" id="prompt">What emotions do you avoid feeling, and why?</div>
        <textarea id="writing-area" class="writing-area" placeholder="Start writing..."></textarea>
        <div class="word-count" id="word-count">Word count: 0</div>
        <div id="flashing-light"></div>
        <div class="timer" id="timer">5:00</div>
        <button onclick="getNewPrompt()">New Prompt</button>
    </div>

    <script>
        const prompts = [
            "What emotions do you avoid feeling, and why?",
            "Describe a time when you felt unworthy. What caused that feeling?",
            "What are your biggest fears, and how do they hold you back?",
            "What part of yourself do you hide from others, and why?",
            "Who has hurt you the most, and what would you say to them?"
        ];

        const writingArea = document.getElementById('writing-area');
        const flashingLight = document.getElementById('flashing-light');
        const wordCountDisplay = document.getElementById('word-count');
        const timerDisplay = document.getElementById('timer');

        let typingTimer;
        const typingDelay = 5000; // 5 seconds of inactivity
        let timerInterval;
        let timerSeconds = 300; // 5 minutes in seconds

        writingArea.addEventListener('input', () => {
            clearTimeout(typingTimer);
            flashingLight.style.display = 'none'; // Hide the flashing light
            updateWordCount();
            typingTimer = setTimeout(() => {
                writingArea.style.animation = 'flash 1s infinite';
            }, typingDelay);
        });

        function updateWordCount() {
            const wordCount = writingArea.value.trim().split(/\s+/).filter(word => word).length;
            wordCountDisplay.textContent = `Word count: ${wordCount}`;
        }

        function showFlashingLight() {
            flashingLight.style.display = 'block'; // Show the flashing light
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerSeconds = 300;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                if (timerSeconds > 0) {
                    timerSeconds--;
                    updateTimerDisplay();
                } else {
                    clearInterval(timerInterval);
                    timerDisplay.classList.add('warning');
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            timerDisplay.classList.remove('warning');
        }

        function getNewPrompt() {
            if (writingArea.value.trim() !== '') {
                const confirmNewPrompt = confirm('Are you sure you want to select a new prompt? This will clear your current response.');
                if (!confirmNewPrompt) return;
            }
            const randomIndex = Math.floor(Math.random() * prompts.length);
            document.getElementById('prompt').innerText = prompts[randomIndex];
            writingArea.value = '';
            updateWordCount();
            startTimer();
        }

        function saveResponseLocally() {
            const response = writingArea.value.trim();
            if (response) {
                const savedResponses = JSON.parse(localStorage.getItem('responses') || '[]');
                savedResponses.push({
                    prompt: document.getElementById('prompt').innerText,
                    response,
                    timestamp: new Date().toISOString()
                });
                localStorage.setItem('responses', JSON.stringify(savedResponses));
                alert('Your response has been saved locally.');
            }
        }

        window.addEventListener('beforeunload', saveResponseLocally);
    </script>
</body>
</html>
